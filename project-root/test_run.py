import sys
import os

# 1. í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œë¥¼ íƒìƒ‰ ê²½ë¡œì— ì¶”ê°€ (backend.app... ìž„í¬íŠ¸ ê°€ëŠ¥í•˜ê²Œ í•¨)
sys.path.append(os.getcwd())

from backend.app.core.engine import GameState, Engine
from backend.app.core.card import CARD_DB

def run_battle_test():
    print("ðŸš€ [ì „íˆ¬ ë¡œì§ í†µí•© í…ŒìŠ¤íŠ¸] ì‹œìž‘ (ëª¨ë“  ìˆ˜ì¹˜ ì†Œë¬¸ìž hp/mana ê¸°ì¤€)\n")
    
    # 2. ê²Œìž„ ì´ˆê¸°í™”
    player_ids = ["User_A", "User_B"]
    state = GameState(player_ids)
    
    # GameStateì— í•„ìš”í•œ ì¢…ë£Œ í”Œëž˜ê·¸ ìˆ˜ë™ í™•ì¸/ì„¤ì •
    state.is_game_over = False
    state.winner = None
    
    engine = Engine(state)
    engine.setup_game()
    
    # 3. í…ŒìŠ¤íŠ¸ìš© HP/Mana ì„¤ì • (ì†Œë¬¸ìž ê¸°ì¤€)
    state.players["User_A"]["hp"] = 30
    state.players["User_A"]["mana"] = 10
    state.players["User_B"]["hp"] = 30
    state.players["User_B"]["mana"] = 10

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì‹œë‚˜ë¦¬ì˜¤ 1: BloodDraw (ë‚´ hp ì†Œëª¨í•˜ì—¬ ì¹´ë“œ ë½‘ê¸°)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("--- [í…ŒìŠ¤íŠ¸ 1] User_A: 'BloodDraw' ì¹´ë“œ ì‚¬ìš© ---")
    if "BloodDraw" in CARD_DB:
        state.players["User_A"]["hand"].append("BloodDraw")
        hand_before = len(state.players["User_A"]["hand"])
        
        success, msg = engine.play_card("User_A", "BloodDraw")
        
        # ì‹¤ì œ ë°˜ì˜ëœ hp í™•ì¸
        current_hp = state.players["User_A"]["hp"]
        print(f"ê²°ê³¼: {success} | User_A hp: {current_hp} (ì˜ˆìƒ: 20)")
        print(f"í•¸ë“œ ë³€í™”: {hand_before} -> {len(state.players['User_A']['hand'])} (ì‚¬ìš© í›„ 3ìž¥ ë“œë¡œìš°ë¡œ +2ìž¥ í™•ì¸)")
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì‹œë‚˜ë¦¬ì˜¤ 2: BloodArrow (ìží•´í•˜ë©° ìƒëŒ€ë°© ê³µê²©)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\n--- [í…ŒìŠ¤íŠ¸ 2] User_A: 'BloodArrow' ì¹´ë“œ ì‚¬ìš© ---")
    if "BloodArrow" in CARD_DB:
        state.players["User_A"]["actions"] = 1
        state.players["User_A"]["hand"].append("BloodArrow")
            
        engine.play_card("User_A", "BloodArrow")
        
        print(f"User_A hp: {state.players['User_A']['hp']} (20ì—ì„œ -5 ì†Œëª¨ -> ì˜ˆìƒ: 15)")
        print(f"User_B hp: {state.players['User_B']['hp']} (30ì—ì„œ -15 í”¼í•´ -> ì˜ˆìƒ: 15)")

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì‹œë‚˜ë¦¬ì˜¤ 3: Madness (ì¹˜ëª…ì  ìží•´ë¡œ ì¸í•œ íŒ¨ë°° íŒì •)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\n--- [í…ŒìŠ¤íŠ¸ 3] User_A: 'Madness' ì‚¬ìš© (ìží•´ -20ìœ¼ë¡œ ì¸í•œ ì‚¬ë§) ---")
    if "Madness" in CARD_DB:
        state.players["User_A"]["actions"] = 1
        state.players["User_A"]["hand"].append("Madness")
        
        # í˜„ìž¬ Aì˜ hpëŠ” 15, Madness íš¨ê³¼ëŠ” -20ì´ë¯€ë¡œ ì‚¬ë§í•´ì•¼ í•¨
        engine.play_card("User_A", "Madness")
        
        print(f"User_A ìµœì¢… hp: {state.players['User_A']['hp']} (ì˜ˆìƒ: -5)")
        print(f"ê²Œìž„ ì¢…ë£Œ í”Œëž˜ê·¸: {state.is_game_over} (ì˜ˆìƒ: True)")
        print(f"ìµœì¢… ìŠ¹ìž: {state.winner} (ì˜ˆìƒ: User_B)")

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìµœì¢… ë¡œê·¸ í™•ì¸
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\n--- ðŸ“œ ì—”ì§„ ë‚´ë¶€ ë¡œê·¸ ê¸°ë¡ ---")
    for log in state.logs:
        print(f"> {log}")

if __name__ == "__main__":
    run_battle_test()