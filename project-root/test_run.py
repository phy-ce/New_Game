import sys
import os

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œë¥¼ ì¶”ê°€í•˜ì—¬ backend.app... ìž„í¬íŠ¸ê°€ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
sys.path.append(os.getcwd())

from backend.app.core.engine import GameState, Engine
from backend.app.core.card import CARD_DB

def run_actual_card_test():
    print("ðŸš€ [ì‹¤ì œ CARD_DB ì—°ë™ í…ŒìŠ¤íŠ¸] ì‹œìž‘\n")
    
    # 1. ì´ˆê¸°í™”
    player_ids = ["User_A", "User_B"]
    state = GameState(player_ids)
    
    # GameStateì— ëˆ„ë½ë˜ì—ˆì„ ìˆ˜ ìžˆëŠ” ì¢…ë£Œ í”Œëž˜ê·¸ ìˆ˜ë™ ì¶”ê°€ (ì—”ì§„ ë¡œì§ìš©)
    state.is_game_over = False
    state.winner = None
    
    engine = Engine(state)
    engine.setup_game()
    
    # í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ HP ì´ˆê¸°í™” (GameStateì˜ 'hp' í‚¤ ì‚¬ìš©)
    state.players["User_A"]["hp"] = 30
    state.players["User_B"]["hp"] = 30

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì‹œë‚˜ë¦¬ì˜¤ 1: BloodDraw í…ŒìŠ¤íŠ¸ (ë‚´ í”¼ -10, ì¹´ë“œ +3)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("--- [í…ŒìŠ¤íŠ¸ 1] User_A: 'BloodDraw' ì‚¬ìš© ---")
    if "BloodDraw" in CARD_DB:
        state.players["User_A"]["hand"].append("BloodDraw")
        hand_before = len(state.players["User_A"]["hand"])
        
        success, msg = engine.play_card("User_A", "BloodDraw")
        
        print(f"ê²°ê³¼: {success} | hp: {state.players['User_A']['hp']} (ì˜ˆìƒ 20)")
        print(f"í•¸ë“œ ë³€í™”: {hand_before} -> {len(state.players['User_A']['hand'])} (3ìž¥ ì¶”ê°€ ë“œë¡œìš° í™•ì¸)")
    else:
        print("âŒ ì˜¤ë¥˜: CARD_DBì— 'BloodDraw'ê°€ ì—†ìŠµë‹ˆë‹¤.")

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì‹œë‚˜ë¦¬ì˜¤ 2: BloodArrow í…ŒìŠ¤íŠ¸ (ë‚´ í”¼ -5, ìƒëŒ€ HP -15)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\n--- [í…ŒìŠ¤íŠ¸ 2] User_A: 'BloodArrow' ì‚¬ìš© ---")
    if "BloodArrow" in CARD_DB:
        state.players["User_A"]["hand"].append("BloodArrow")
        
        engine.play_card("User_A", "BloodArrow")
        
        print(f"User_A hp: {state.players['User_A']['hp']} (ì˜ˆìƒ 15)")
        print(f"User_B hp: {state.players['User_B']['hp']} (ì˜ˆìƒ 15)")
    else:
        print("âŒ ì˜¤ë¥˜: CARD_DBì— 'BloodArrow'ê°€ ì—†ìŠµë‹ˆë‹¤.")

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì‹œë‚˜ë¦¬ì˜¤ 3: ì‚¬ë§ íŒì • í…ŒìŠ¤íŠ¸ (User_A ìží•´ ì‚¬ë§)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\n--- [í…ŒìŠ¤íŠ¸ 3] User_A: 'Madness' ì‚¬ìš©ìœ¼ë¡œ ìží•´ ì‚¬ë§ (hp -20) ---")
    if "Madness" in CARD_DB:
        state.players["User_A"]["hand"].append("Madness")
        
        # í˜„ìž¬ Aì˜ í”¼ëŠ” 15ì´ë¯€ë¡œ Madness(-20) ì‚¬ìš© ì‹œ ì‚¬ë§í•´ì•¼ í•¨
        engine.play_card("User_A", "Madness")
        
        print(f"User_1 hp: {state.players['User_A']['hp']} (ì˜ˆìƒ -5)")
        print(f"ê²Œìž„ ì¢…ë£Œ: {state.is_game_over}")
        print(f"ìŠ¹ìž: {state.winner} (ì˜ˆìƒ User_B)")
    else:
        print("âŒ ì˜¤ë¥˜: CARD_DBì— 'Madness'ê°€ ì—†ìŠµë‹ˆë‹¤.")

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìµœì¢… ë¡œê·¸ ì¶œë ¥
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\n--- ðŸ“œ ìµœì¢… ê²Œìž„ ë¡œê·¸ ---")
    for log in state.logs[-5:]:
        print(f"> {log}")

if __name__ == "__main__":
    run_actual_card_test()